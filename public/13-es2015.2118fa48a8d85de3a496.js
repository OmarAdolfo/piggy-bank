(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{vnru:function(t,e,i){"use strict";i.r(e);var r=i("PCNd"),o=i("tyNb"),a=i("3Pt+"),n=i("fXoL"),s=i("AytR"),c=i("tk/3");let d=(()=>{class t{constructor(t){this.http=t,this.url=s.a.url+"meta-ahorros",this.urlYearlySaving=s.a.url+"ahorros-anuales"}get(t,e,i,r){let o=[],a="";return t.anno&&o.push("anno="+t.anno),e&&(o.push("sortable="+e),i&&o.push(1===i?"orderBy=asc":"orderBy=desc")),r&&o.push("page="+r),o.length>0&&(a="?"+o.join("&")),this.http.get(this.url+a)}find(t){return this.http.get(this.url+"/"+t)}add(t){return this.http.post(this.url,t)}update(t,e){return this.http.put(this.url+"/"+e,t)}delete(t){return this.http.delete(this.url+"/"+t)}getYearlySaving(){return this.http.get(this.urlYearlySaving)}}return t.\u0275fac=function(e){return new(e||t)(n.Yb(c.b))},t.\u0275prov=n.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var b=i("7zfz"),l=i("ofXK"),u=i("rEr+"),m=i("jIHw");function f(t,e){if(1&t&&n.Pb(0,"p-sortIcon",21),2&t){const t=n.ec().$implicit;n.kc("field",t.field)}}function g(t,e){if(1&t&&(n.Ub(0,"th",19),n.Hc(1),n.Fc(2,f,1,1,"p-sortIcon",20),n.Tb()),2&t){const t=e.$implicit;n.kc("pSortableColumn",t.field),n.Cb(1),n.Jc(" ",t.header," "),n.Cb(1),n.kc("ngIf",t.sortOrder)}}function h(t,e){if(1&t&&(n.Ub(0,"tr"),n.Fc(1,g,3,3,"th",18),n.Tb()),2&t){const t=e.$implicit;n.Cb(1),n.kc("ngForOf",t)}}function p(t,e){1&t&&(n.Ub(0,"span"),n.Hc(1,"SUPERADO"),n.Tb()),2&t&&n.Eb("customer-badge status-qualified")}function v(t,e){1&t&&(n.Ub(0,"span"),n.Hc(1,"NO SUPERADO"),n.Tb()),2&t&&n.Eb("customer-badge status-unqualified")}function T(t,e){if(1&t){const t=n.Vb();n.Ub(0,"tr",22),n.Ub(1,"td"),n.Ub(2,"span",23),n.Hc(3,"A\xf1o"),n.Tb(),n.Hc(4),n.Tb(),n.Ub(5,"td"),n.Ub(6,"span",23),n.Hc(7,"Cantidad"),n.Tb(),n.Hc(8),n.Tb(),n.Ub(9,"td"),n.Ub(10,"span",23),n.Hc(11,"Ahorrado"),n.Tb(),n.Hc(12),n.Tb(),n.Ub(13,"td"),n.Fc(14,p,2,2,"span",24),n.Fc(15,v,2,2,"span",24),n.Tb(),n.Ub(16,"td"),n.Ub(17,"button",25),n.cc("click",(function(){n.xc(t);const i=e.$implicit;return n.ec().onRowSelect(i.id)})),n.Ub(18,"span"),n.Pb(19,"i",26),n.Tb(),n.Tb(),n.Ub(20,"button",25),n.cc("click",(function(){n.xc(t);const i=e.$implicit;return n.ec().confirm(i.id)})),n.Ub(21,"span"),n.Pb(22,"i",27),n.Tb(),n.Tb(),n.Tb(),n.Tb()}if(2&t){const t=e.$implicit,i=n.ec();n.kc("pSelectableRow",t),n.Cb(4),n.Jc(" ",t.anno," "),n.Cb(4),n.Jc(" ",t.cantidad," "),n.Cb(4),n.Jc(" ",i.getSavings(t.anno)," "),n.Cb(2),n.kc("ngIf",i.getStatus(t.cantidad,t.anno)),n.Cb(1),n.kc("ngIf",!i.getStatus(t.cantidad,t.anno))}}function U(t,e){if(1&t){const t=n.Vb();n.Ub(0,"div",28),n.Ub(1,"button",29),n.cc("click",(function(){return n.xc(t),n.ec().add()})),n.Tb(),n.Tb()}}const S=function(t,e){return{"fa-search":t,"fa-spinner fa-spin":e}};let y=(()=>{class t{constructor(t,e,i,r,o){this.metaSavingService=t,this.formBuilder=e,this.messageService=i,this.confirmationService=r,this.router=o,this.cols=[{field:"anno",header:"A\xf1o",sortOrder:!0},{field:"cantidad",header:"Objetivo",sortOrder:!0},{field:"",header:"Ahorrado",sortOrder:!1},{field:"",header:"Estado",sortOrder:!1},{field:"",header:"Opciones",sortOrder:!1}],this.statuses=[{label:"No superado",value:"no-superado"},{label:"Superado",value:"superado"}]}ngOnInit(){this.getYearlySaving(),this.buildForm()}getYearlySaving(){this.metaSavingService.getYearlySaving().subscribe(t=>{this.pagos=t.pagos,this.ingresos=t.ingresos})}getSavings(t){const e=this.pagos.find(e=>e.anno===t),i=this.ingresos.find(e=>e.anno===t),r=e?this.pagos.find(e=>e.anno===t).total:0;return((i?this.ingresos.find(e=>e.anno===t).total:0)-r).toFixed(2)}getStatus(t,e){const i=this.pagos.find(t=>t.anno===e),r=this.ingresos.find(t=>t.anno===e),o=i?this.pagos.find(t=>t.anno===e).total:0;return t<=(r?this.ingresos.find(t=>t.anno===e).total:0)-o}buildForm(){this.form=this.formBuilder.group({anno:new a.c("")})}add(){this.router.navigate(["/home/objectives/new"])}search(t,e,i){Promise.resolve().then(()=>this.loading=!0),this.metaSavingService.get(this.form.value,t,e,i).subscribe(t=>{this.metasSaving=t.data.data,this.totalRecords=t.data.total,this.loading=!1},()=>{this.loading=!1})}customSort(t){this.search(t.sortField,t.sortOrder,t.first/t.rows+1)}confirm(t){this.confirmationService.confirm({message:"\xbfEst\xe1s seguro de que deseas borrar?",header:"Confirmaci\xf3n",icon:"pi pi-exclamation-triangle",accept:()=>{this.delete(t)}})}delete(t){this.metaSavingService.delete(t).subscribe(e=>{this.metasSaving=this.metasSaving.filter(e=>e.id!==t),this.messageService.add({severity:"success",summary:"\xc9xito",detail:e.message})},t=>{this.messageService.add({severity:"error",summary:"Error",detail:t.error.message})})}onRowSelect(t){this.router.navigate(["/home/objectives/"+t])}}return t.\u0275fac=function(e){return new(e||t)(n.Ob(d),n.Ob(a.b),n.Ob(b.d),n.Ob(b.a),n.Ob(o.b))},t.\u0275cmp=n.Ib({type:t,selectors:[["app-meta-saving"]],decls:34,vars:13,consts:[[1,"wrapper"],[1,"row"],[1,"col-12"],[1,"card","mt-3"],[1,"card-header","bg-primary","text-white"],[1,"card-body"],[3,"formGroup"],[1,"col-12","col-md-6","form-group"],["for","anno"],["type","text","id","anno","formControlName","anno",1,"form-control","form-control-user"],[1,"row","mt-1"],[1,"col-12","text-right","mt-2"],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["aria-hidden","true",1,"fas",3,"ngClass"],[3,"columns","value","paginator","rows","responsive","lazy","totalRecords","onLazyLoad"],["pTemplate","header"],["pTemplate","body"],["pTemplate","summary"],[3,"pSortableColumn",4,"ngFor","ngForOf"],[3,"pSortableColumn"],[3,"field",4,"ngIf"],[3,"field"],[3,"pSelectableRow"],[1,"ui-column-title"],[3,"class",4,"ngIf"],["type","button",1,"btn","btn-secondary","mr-1",3,"click"],["aria-hidden","true",1,"fas","fa-edit"],["aria-hidden","true",1,"fas","fa-trash"],[2,"text-align","left"],["type","button","pButton","","icon","pi pi-plus","label","A\xf1adir",3,"click"]],template:function(t,e){1&t&&(n.Ub(0,"div",0),n.Ub(1,"div",1),n.Ub(2,"div",2),n.Ub(3,"h1"),n.Hc(4,"Objetivos"),n.Tb(),n.Tb(),n.Tb(),n.Pb(5,"hr"),n.Ub(6,"div",3),n.Ub(7,"div",4),n.Hc(8," Buscador de objetivos "),n.Tb(),n.Ub(9,"div",5),n.Ub(10,"div",1),n.Ub(11,"div",2),n.Ub(12,"form",6),n.Ub(13,"div",1),n.Ub(14,"div",7),n.Ub(15,"label",8),n.Hc(16,"A\xf1o"),n.Tb(),n.Pb(17,"input",9),n.Tb(),n.Tb(),n.Ub(18,"div",10),n.Ub(19,"div",11),n.Ub(20,"button",12),n.cc("click",(function(){return e.search()})),n.Pb(21,"i",13),n.Ub(22,"span"),n.Hc(23," Buscar"),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Ub(24,"div",3),n.Ub(25,"div",4),n.Hc(26," Listado de objetivos "),n.Tb(),n.Ub(27,"div",5),n.Ub(28,"div",1),n.Ub(29,"div",2),n.Ub(30,"p-table",14),n.cc("onLazyLoad",(function(t){return e.customSort(t)})),n.Fc(31,h,2,1,"ng-template",15),n.Fc(32,T,23,6,"ng-template",16),n.Fc(33,U,2,0,"ng-template",17),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Tb()),2&t&&(n.Cb(12),n.kc("formGroup",e.form),n.Cb(8),n.kc("disabled",e.loading),n.Cb(1),n.kc("ngClass",n.oc(10,S,!e.loading,e.loading)),n.Cb(9),n.kc("columns",e.cols)("value",e.metasSaving)("paginator",!0)("rows",10)("responsive",!0)("lazy",!0)("totalRecords",e.totalRecords))},directives:[a.o,a.i,a.e,a.a,a.h,a.d,l.i,u.d,b.e,l.j,u.c,l.k,u.b,u.a,m.a],styles:[".customer-badge[_ngcontent-%COMP%]{border-radius:2px;padding:.25em .5em;text-transform:uppercase;font-weight:700;font-size:12px;letter-spacing:.3px}.customer-badge.status-qualified[_ngcontent-%COMP%]{background-color:#c8e6c9;color:#256029}.customer-badge.status-unqualified[_ngcontent-%COMP%]{background-color:#ffcdd2;color:#c63737}"]}),t})();class k{}var C=i("Gxio"),w=i("kAuD");function O(t,e){1&t&&(n.Ub(0,"div",1),n.Pb(1,"img",9),n.Tb())}function x(t,e){1&t&&(n.Ub(0,"div"),n.Hc(1," El a\xf1o es obligatorio "),n.Tb())}function F(t,e){1&t&&(n.Ub(0,"div"),n.Hc(1," El a\xf1o debe estar formado por cuatro n\xfameros "),n.Tb())}function H(t,e){if(1&t&&(n.Ub(0,"div",24),n.Fc(1,x,2,0,"div",25),n.Fc(2,F,2,0,"div",25),n.Tb()),2&t){const t=n.ec(2);n.Cb(1),n.kc("ngIf",t.form.controls.anno.errors.required),n.Cb(1),n.kc("ngIf",t.form.controls.anno.errors.pattern)}}function I(t,e){1&t&&(n.Ub(0,"div"),n.Hc(1," La cantidad es obligatoria "),n.Tb())}function P(t,e){if(1&t&&(n.Ub(0,"div",24),n.Fc(1,I,2,0,"div",25),n.Tb()),2&t){const t=n.ec(2);n.Cb(1),n.kc("ngIf",t.form.controls.cantidad.errors.required)}}const R=function(t,e){return{"fa-save":t,"fa-spinner fa-spin":e}};function j(t,e){if(1&t){const t=n.Vb();n.Ub(0,"div",10),n.Ub(1,"div",11),n.Hc(2," Dise\xf1ador objetivo "),n.Tb(),n.Ub(3,"div",12),n.Ub(4,"div",1),n.Ub(5,"div",2),n.Ub(6,"form",13),n.Ub(7,"div",1),n.Ub(8,"div",14),n.Ub(9,"label",15),n.Hc(10,"A\xf1o"),n.Tb(),n.Pb(11,"input",16),n.Fc(12,H,3,2,"div",17),n.Tb(),n.Ub(13,"div",14),n.Ub(14,"label",18),n.Hc(15,"Cantidad"),n.Tb(),n.Pb(16,"input",19),n.Fc(17,P,2,1,"div",17),n.Tb(),n.Tb(),n.Ub(18,"div",20),n.Ub(19,"div",21),n.Ub(20,"button",22),n.cc("click",(function(){return n.xc(t),n.ec().save()})),n.Ub(21,"span"),n.Pb(22,"i",23),n.Hc(23," Guardar "),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Tb()}if(2&t){const t=n.ec();n.Cb(6),n.kc("formGroup",t.form),n.Cb(6),n.kc("ngIf",t.form.controls.anno.invalid&&(t.form.controls.anno.dirty||t.form.controls.anno.touched)),n.Cb(5),n.kc("ngIf",t.form.controls.cantidad.invalid&&(t.form.controls.cantidad.dirty||t.form.controls.cantidad.touched)),n.Cb(3),n.kc("disabled",t.form.pristine||t.form.invalid||t.loading),n.Cb(2),n.kc("ngClass",n.oc(5,R,!t.loading,t.loading))}}const E=function(){return{marginTop:"80px"}},A=[{path:"",component:y},{path:":id",component:(()=>{class t{constructor(t,e,i,r,o){this.formBuilder=t,this.metasavingService=e,this.activatedRoute=i,this.location=r,this.messageService=o,this.annoRegex=/^(\d{4})$/}ngOnInit(){this.newMetaSaving="new"===this.activatedRoute.snapshot.params.id,this.newMetaSaving?(this.metaSaving=new k,this.buildForm()):(Promise.resolve().then(()=>this.loading=!0),this.metasavingService.find(this.activatedRoute.snapshot.params.id).subscribe(t=>{this.metaSaving=t.data,this.loading=!1,this.buildForm()},t=>{this.loading=!1,this.messageService.add({severity:"error",summary:"Error",detail:t.error.message})}))}buildForm(){this.form=this.formBuilder.group({anno:new a.c(this.metaSaving.anno,[a.n.required,a.n.pattern(this.annoRegex)]),cantidad:new a.c(this.metaSaving.cantidad,[a.n.required])})}save(){if(Promise.resolve().then(()=>this.loading=!0),this.metaSaving.id){const t=Object.assign(this.metaSaving,this.form.value);this.metasavingService.update(t,this.metaSaving.id).subscribe(t=>{this.loading=!1,this.back()},t=>{this.loading=!1,this.messageService.add({severity:"error",summary:"Error",detail:t.error.message})})}else{const t=Object.assign({},this.form.value);this.metasavingService.add(t).subscribe(t=>{this.loading=!1,this.back()},t=>{this.loading=!1,this.messageService.add({severity:"error",summary:"Error",detail:t.error.message})})}}back(){this.location.back()}}return t.\u0275fac=function(e){return new(e||t)(n.Ob(a.b),n.Ob(d),n.Ob(o.a),n.Ob(l.g),n.Ob(b.d))},t.\u0275cmp=n.Ib({type:t,selectors:[["app-meta-saving-detail"]],decls:15,vars:5,consts:[[1,"wrapper"],[1,"row"],[1,"col-12"],["class","row",4,"ngIf"],["class","card",4,"ngIf"],[1,"row","mt-3"],[1,"col-12","text-right"],["type","button",1,"btn","btn-secondary","mr-1",3,"click"],["aria-hidden","true",1,"fas","fa-arrow-left"],["src","./assets/notfound.png","alt","No existen resultados",1,"d-block","mx-auto","img-not-found"],[1,"card"],[1,"card-header","bg-primary","text-white"],[1,"card-body"],[3,"formGroup"],[1,"col-12","col-md-6","form-group"],["for","anno"],["type","number","id","anno","formControlName","anno",1,"form-control","form-control-user"],["class","alert alert-danger mt-1",4,"ngIf"],["for","cantidad"],["type","textbox","formControlName","cantidad","placeholder","XX.XX","appTwoDigitDecimaNumber","",1,"form-control","form-control-user"],[1,"row","mt-1"],[1,"col-12","text-right","mt-2"],["type","button",1,"btn","btn-primary","mr-1",3,"disabled","click"],["aria-hidden","true",1,"fas",3,"ngClass"],[1,"alert","alert-danger","mt-1"],[4,"ngIf"]],template:function(t,e){1&t&&(n.Ub(0,"div",0),n.Ub(1,"div",1),n.Ub(2,"div",2),n.Ub(3,"h1"),n.Hc(4,"Detalle meta de ahorro"),n.Tb(),n.Tb(),n.Tb(),n.Pb(5,"hr"),n.Fc(6,O,2,0,"div",3),n.Fc(7,j,24,8,"div",4),n.Ub(8,"div",5),n.Ub(9,"div",6),n.Ub(10,"button",7),n.cc("click",(function(){return e.back()})),n.Ub(11,"span"),n.Pb(12,"i",8),n.Hc(13," Volver"),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Tb(),n.Pb(14,"p-toast")),2&t&&(n.Cb(6),n.kc("ngIf",!e.metaSaving&&!e.loading),n.Cb(1),n.kc("ngIf",e.metaSaving),n.Cb(7),n.Dc(n.mc(4,E)))},directives:[l.k,C.a,a.o,a.i,a.e,a.k,a.a,a.h,a.d,w.a,l.i],styles:[""]}),t})()}];let q=(()=>{class t{}return t.\u0275mod=n.Mb({type:t}),t.\u0275inj=n.Lb({factory:function(e){return new(e||t)},imports:[[o.e.forChild(A)],o.e]}),t})();i.d(e,"MetaSavingModule",(function(){return B}));let B=(()=>{class t{}return t.\u0275mod=n.Mb({type:t}),t.\u0275inj=n.Lb({factory:function(e){return new(e||t)},imports:[[r.a,q]]}),t})()}}]);