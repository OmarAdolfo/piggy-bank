<div class="wrapper">
    <div class="row">
        <div class="col-12">
            <h1>Plantillas</h1>
        </div>
    </div>
    <hr>

    <div class="row mt-3">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    Creador de plantillas
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-12">
                            <div class="ui-g" style="width:250px;margin-bottom:10px">
                                <div class="ui-g-12">
                                    <p-radioButton name="group1" value="Añadir plantilla" label="Añadir plantilla"
                                        [(ngModel)]="optionCreation" inputId="opt1">
                                    </p-radioButton>
                                </div>
                                <div class="ui-g-12">
                                    <p-radioButton name="group1" value="Copiar plantilla" label="Copiar plantilla"
                                        [(ngModel)]="optionCreation" inputId="opt2">
                                    </p-radioButton>
                                </div>
                            </div>
                        </div>
                    </div>
                    <form *ngIf="optionCreation === 'Añadir plantilla'" [formGroup]="addForm">
                        <div class="row mt-3">
                            <div class="col-12 col-md-4 form-group">
                                <label for="anno">Año</label>
                                <input type="number" class="form-control form-control-user" id="anno"
                                    formControlName="anno">
                                <div *ngIf="addForm.controls.anno.invalid && (addForm.controls.anno.dirty || addForm.controls.anno.touched)"
                                    class="alert alert-danger mt-1">
                                    <div *ngIf="addForm.controls.anno.errors.required">
                                        El año es obligatorio
                                    </div>
                                    <div *ngIf="addForm.controls.anno.errors.pattern">
                                        El año debe estar formado por cuatro números
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-md-4 form-group">
                                <label for="mes">Mes</label>
                                <p-dropdown [options]="months" formControlName="mes" placeholder="Seleccione un mes"
                                    optionLabel="name" [showClear]="true">
                                </p-dropdown>
                                <div *ngIf="addForm.controls.mes.invalid && (addForm.controls.mes.dirty || addForm.controls.mes.touched)"
                                    class="alert alert-danger mt-1">
                                    <div *ngIf="addForm.controls.mes.errors.required">
                                        El mes es obligatorio
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-md-4 form-group text-right d-flex align-items-end">
                                <button [disabled]="addForm.pristine || addForm.invalid || loading" type="button"
                                    (click)="addTemplate()" class="btn btn-primary mr-4">
                                    <i class="fas" [ngClass]="{'fa-plus': !loading, 'fa-spinner fa-spin': loading}"
                                        aria-hidden="true"></i>
                                    <span> Añadir</span>
                                </button>
                            </div>
                        </div>
                    </form>
                    <form *ngIf="optionCreation === 'Copiar plantilla'" [formGroup]="cloneForm">
                        <div class="row mt-3">
                            <div class="col-12 col-md-4 form-group">
                                <label for="anno">Año</label>
                                <input type="number" class="form-control form-control-user" id="anno"
                                    formControlName="anno">
                                <div *ngIf="cloneForm.controls.anno.invalid && (cloneForm.controls.anno.dirty || cloneForm.controls.anno.touched)"
                                    class="alert alert-danger mt-1">
                                    <div *ngIf="cloneForm.controls.anno.errors.required">
                                        El año es obligatorio
                                    </div>
                                    <div *ngIf="cloneForm.controls.anno.errors.pattern">
                                        El año debe estar formado por cuatro números
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-md-4 form-group">
                                <label for="mes">Mes</label>
                                <p-dropdown [options]="months" formControlName="mes" placeholder="Seleccione un mes"
                                    optionLabel="name" [showClear]="true">
                                </p-dropdown>
                                <div *ngIf="cloneForm.controls.mes.invalid && (cloneForm.controls.mes.dirty || cloneForm.controls.mes.touched)"
                                    class="alert alert-danger mt-1">
                                    <div *ngIf="cloneForm.controls.mes.errors.required">
                                        El mes es obligatorio
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12 col-md-4 form-group">
                                <label for="anno">Nuevo año</label>
                                <input type="number" class="form-control form-control-user" id="anno"
                                    formControlName="newAnno">
                                <div *ngIf="cloneForm.controls.newAnno.invalid && (cloneForm.controls.newAnno.dirty || cloneForm.controls.newAnno.touched)"
                                    class="alert alert-danger mt-1">
                                    <div *ngIf="cloneForm.controls.newAnno.errors.required">
                                        El año es obligatorio
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-md-4 form-group">
                                <label for="mes">Nuevo mes</label>
                                <p-dropdown [options]="months" formControlName="newMes" placeholder="Seleccione un mes"
                                    optionLabel="name" [showClear]="true">
                                </p-dropdown>
                                <div *ngIf="cloneForm.controls.newMes.invalid && (cloneForm.controls.newMes.dirty || cloneForm.controls.newMes.touched)"
                                    class="alert alert-danger mt-1">
                                    <div *ngIf="cloneForm.controls.newMes.errors.required">
                                        El mes es obligatorio
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-md-4 form-group text-right d-flex align-items-end">
                                <button [disabled]="cloneForm.pristine || cloneForm.invalid || loading" type="button"
                                    (click)="clone()" class="btn btn-primary">
                                    <i class="fas" [ngClass]="{'fa-edit': !loading, 'fa-spinner fa-spin': loading}"
                                        aria-hidden="true"></i>
                                    <span> Copiar</span>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-3">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    Listado de plantillas
                </div>
                <div class="card-body">
                    <div *ngIf="templatesTotal?.length > 0; else noTemplates">
                        <div class="row mt-3">
                            <div class="col-12 col-md-3 form-group">
                                <label for="exampleInputEmail1">Seleccione un año:</label>
                                <p-dropdown [(ngModel)]="selectedYear" [options]="years" optionLabel="anno"
                                    placeholder="Seleccione un año" (onChange)="selectYear($event)"></p-dropdown>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12 col-md-4 col-xl-3 mt-3" *ngFor="let template of templates">
                                <div class="card bg-secondary border border-dark">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-12">
                                                {{getMonth(template.mes)}}
                                            </div>
                                            <div class="col-12 text-right">
                                                <button type="button" (click)="editTemplate(template.id)"
                                                    class="btn btn-primary">
                                                    <i class="fas fa-edit" aria-hidden="true"></i>
                                                </button>
                                                <button type="button" (click)="confirm(template.id)"
                                                    class="ml-1 btn btn-primary">
                                                    <i class="fas fa-trash" aria-hidden="true"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <ng-template #noTemplates>
                        <div class="row" *ngIf="!loading">
                            <div class="col-4 offset-4 form-group">
                                <img src="assets/notfound.png" class="d-block mx-auto img-not-found"
                                    alt="No existen resultados">
                            </div>
                        </div>
                    </ng-template>
                </div>
            </div>
        </div>
    </div>
</div>